image: gradle:jdk12

pipelines:
  branches:
    dev:
      - step:
          name: deploy:snapshot
          caches:
            - gradle
          script:
            - bash ./gradlew --build-cache assemble
            - bash ./gradlew checkstyleMain
            - bash ./gradlew publish
    feature/*:
      - step:
          name: deploy:feature
          caches:
            - gradle
          script:
            - bash ./gradlew --build-cache assemble
            - bash ./gradlew checkstyleMain
            - bash ./gradlew publish
    bugfix/*:
      - step:
          name: deploy:bugfix
          caches:
            - gradle
          script:
            - bash ./gradlew --build-cache assemble
            - bash ./gradlew checkstyleMain
            - bash ./gradlew publish
    master:
      - step:
          name: sonar:snapshot
          caches:
            - gradle
          script:
            - bash ./gradlew checkstyleMain
            - bash ./gradlew sonarqube -Dsonar.projectKey=LegendServiceRegistry -Dsonar.host.url=https://sonar.playlegend.dev -Dsonar.login=$SONAR_LOGIN -Dsonar.projectVersion=master
  tags:
    '*.*.*':
      - step:
          name: deploy:release
          caches:
            - gradle
          script:
            - bash ./gradlew --build-cache assemble
            - bash ./gradlew checkstyleMain
            - bash ./gradlew publish